(function(a){'use strict';var b=function(a){var b=arguments,c=!0,d=1;return a=a.replace(/%s/g,function(){var a=b[d++];return"undefined"==typeof a?(c=!1,""):a}),c?a:""},c=function(b,c){var d=-1;return a.each(b,function(a,b){return b.field!==c||(d=a,!1)}),d},d=function(c,d,e,f){var g=d;if("string"==typeof d){var h=d.split(".");1<h.length?(g=window,a.each(h,function(a,b){g=g[b]})):g=window[d]}return"object"==typeof g?g:"function"==typeof g?g.apply(c,e):!g&&"string"==typeof d&&b.apply(this,[d].concat(e))?b.apply(this,[d].concat(e)):f},f=function(a,b){var c=a;if("string"!=typeof b||a.hasOwnProperty(b))return a[b];var d=b.split(".");for(var e in d)c=c[d[e]];return c},e=function(b,c,d){var f=[],g=a.grep(c,function(a){return a.parentId==b[d]});return a.each(g,function(b,g){f.push(g);var h=e(g,c,d);a.each(h,function(a,b){f.push(b)})}),f},g=a.fn.bootstrapTable.Constructor,h=g.prototype.initData,i=g.prototype.initBody;g.prototype.initData=function(){h.apply(this,Array.prototype.slice.apply(arguments));var b=this;if(b.options.treeView&&0<this.data.length){var c=[],d=a.grep(this.data,function(a){return!a.parentId||"0"==a.parentId});a.each(d,function(d,f){f.level=0,c.push(f);var g=e(f,b.data,b.options.treeId);a.each(g,function(a,d){b.options.treeCollapseAll&&(d.hidden=!0),c.push(d)})}),b.options.data=b.data=c}},g.prototype.initBody=function(e){var g=this,h=[],j=this.getData();this.trigger("pre-body",j),this.$body=this.$el.find("tbody"),this.$body.length||(this.$body=a("<tbody></tbody>").appendTo(this.$el)),this.options.pagination&&"server"!==this.options.sidePagination||(this.pageFrom=1,this.pageTo=j.length);for(var k=this.pageFrom-1;k<this.pageTo;k++){var l,m=j[k],n={},o=[],p="",q={},r=[];if(!m.hidden){if(n=d(this.options,this.options.rowStyle,[m,k],n),n&&n.css)for(l in n.css)o.push(l+": "+n.css[l]);if(q=d(this.options,this.options.rowAttributes,[m,k],q),q)for(l in q)r.push(b("%s=\"%s\"",l,escapeHTML(q[l])));m._data&&!a.isEmptyObject(m._data)&&a.each(m._data,function(a,c){"index"===a||(p+=b(" data-%s=\"%s\"",a,c))}),h.push("<tr",b(" %s",r.join(" ")),b(" id=\"%s\"",a.isArray(m)?void 0:m._id),b(" class=\"%s\"",n.classes||(a.isArray(m)?void 0:m._class)),b(" data-index=\"%s\"",k),b(" data-uniqueid=\"%s\"",m[this.options.uniqueId]),b("%s",p),">"),this.options.cardView&&h.push(b("<td colspan=\"%s\">",this.header.fields.length)),!this.options.cardView&&this.options.detailView&&h.push("<td>","<a class=\"detail-icon\" href=\"javascript:\">",b("<i class=\"%s %s\"></i>",this.options.iconsPrefix,this.options.icons.detailOpen),"</a>","</td>"),a.each(this.header.fields,function(e,i){var l="",p=f(m,i),q="",r={},s="",t=g.header.classes[e],u="",v="",w="",x=g.columns[c(g.columns,i)];if(x.visible){if(n=b("style=\"%s\"",o.concat(g.header.styles[e]).join("; ")),p=d(x,g.header.formatters[e],[p,m,k],p),m["_"+i+"_id"]&&(s=b(" id=\"%s\"",m["_"+i+"_id"])),m["_"+i+"_class"]&&(t=b(" class=\"%s\"",m["_"+i+"_class"])),m["_"+i+"_rowspan"]&&(v=b(" rowspan=\"%s\"",m["_"+i+"_rowspan"])),m["_"+i+"_title"]&&(w=b(" title=\"%s\"",m["_"+i+"_title"])),r=d(g.header,g.header.cellStyles[e],[p,m,k],r),r.classes&&(t=b(" class=\"%s\"",r.classes)),r.css){var y=[];for(var z in r.css)y.push(z+": "+r.css[z]);n=b("style=\"%s\"",y.concat(g.header.styles[e]).join("; "))}if(m["_"+i+"_data"]&&!a.isEmptyObject(m["_"+i+"_data"])&&a.each(m["_"+i+"_data"],function(a,c){"index"===a||(u+=b(" data-%s=\"%s\"",a,c))}),x.checkbox||x.radio)q=x.checkbox?"checkbox":q,q=x.radio?"radio":q,l=[g.options.cardView?"<div class=\"card-view\">":"<td class=\"bs-checkbox\">","<input"+b(" data-index=\"%s\"",k)+b(" name=\"%s\"",g.options.selectItemName)+b(" type=\"%s\"",q)+b(" value=\"%s\"",m[g.options.idField])+b(" checked=\"%s\"",!0===p||p&&p.checked?"checked":void 0)+b(" disabled=\"%s\"",!x.checkboxEnabled||p&&p.disabled?"disabled":void 0)+" />",g.header.formatters[e]&&"string"==typeof p?p:"",g.options.cardView?"</div>":"</td>"].join(""),m[g.header.stateField]=!0===p||p&&p.checked;else{p="undefined"==typeof p||null===p?g.options.undefinedText:p;var A,B;if(g.options.treeView&&x.field==g.options.treeField){var A=m.level?b("<span style=\"margin-left: %spx;\"></span>",15*m.level):"",C=a.grep(j,function(a){return a.parentId==m[g.options.treeId]&&!a.hidden});B=b("<span class=\"tree-icon %s\" style=\"cursor: pointer; margin: 0px 5px;\"></span>",0<C.length?g.options.expandIcon:g.options.collapseIcon)}l=g.options.cardView?["<div class=\"card-view\">",g.options.showHeader?b("<span class=\"title\" %s>%s</span>",n,getPropertyFromOther(g.columns,"field","title",i)):"",b("<span class=\"value\">%s</span>",p),"</div>"].join(""):[b("<td%s %s %s %s %s %s>",s,t,n,u,v,w),A,B,p,"</td>"].join(""),g.options.cardView&&g.options.smartDisplay&&""===p&&(l="")}h.push(l)}}),this.options.cardView&&h.push("</td>"),h.push("</tr>")}}h.length||h.push("<tr class=\"no-records-found\">",b("<td colspan=\"%s\">%s</td>",this.$header.find("th").length,this.options.formatNoMatches()),"</tr>"),this.$body.html(h.join("")),e||this.scrollTo(0),this.$body.find("> tr[data-index] > td").off("click dblclick").on("click dblclick",function(d){var e=a(this),h=e.parent(),i=g.data[h.data("index")],j=e[0].cellIndex,k=g.header.fields[g.options.detailView&&!g.options.cardView?j-1:j],l=g.columns[c(g.columns,k)],m=f(i,k);if(!e.find(".detail-icon").length&&(g.trigger("click"===d.type?"click-cell":"dbl-click-cell",k,m,i,e),g.trigger("click"===d.type?"click-row":"dbl-click-row",i,h),"click"===d.type&&g.options.clickToSelect&&l.clickToSelect)){var n=h.find(b("[name=\"%s\"]",g.options.selectItemName));n.length&&n[0].click()}}),this.$body.find("> tr[data-index] > td > .detail-icon").off("click").on("click",function(){var c=a(this),e=c.parent().parent(),f=e.data("index"),h=j[f];e.next().is("tr.detail-view")?(c.find("i").attr("class",b("%s %s",g.options.iconsPrefix,g.options.icons.detailOpen)),e.next().remove(),g.trigger("collapse-row",f,h)):(c.find("i").attr("class",b("%s %s",g.options.iconsPrefix,g.options.icons.detailClose)),e.after(b("<tr class=\"detail-view\"><td colspan=\"%s\">%s</td></tr>",e.find("td").length,d(g.options,g.options.detailFormatter,[f,h],""))),g.trigger("expand-row",f,h,e.next().find("td"))),g.resetView()}),this.$body.find("> tr[data-index] > td > .tree-icon").off("click").on("click",function(b){b.stopPropagation();var c=a(this),d=c.parent().parent(),e=d.data("index"),f=j[e],h=a(this),i=function(a,b){for(;b--;){var c=g.data[b];a&&c.parentId==a&&(g.data.splice(b,1),i(c.id,g.data.length))}};if(h.hasClass(g.options.expandIcon)){h.removeClass(g.options.expandIcon).addClass(g.options.collapseIcon);var k=f[g.options.treeId];i(k,g.data.length)}else h.removeClass(g.options.collapseIcon).addClass(g.options.expandIcon),a.when(Autumn.customAjax({url:g.options.url,params:{parentId:f[g.options.treeId]},async:!1})).done(function(a){if(a&&0<a.length)for(var b=a.length-1;0<=b;b--)a[b].level=f.level+1,g.data.splice(e+1,0,a[b])});g.options.data=g.data,g.initBody(!0)}),this.$selectItem=this.$body.find(b("[name=\"%s\"]",this.options.selectItemName)),this.$selectItem.off("click").on("click",function(b){b.stopImmediatePropagation();var c=a(this),d=c.prop("checked"),e=g.data[c.data("index")];g.options.maintainSelected&&a(this).is(":radio")&&a.each(g.options.data,function(a,b){b[g.header.stateField]=!1}),e[g.header.stateField]=d,g.options.singleSelect&&(g.$selectItem.not(this).each(function(){g.data[a(this).data("index")][g.header.stateField]=!1}),g.$selectItem.filter(":checked").not(this).prop("checked",!1)),g.updateSelected(),g.trigger(d?"check":"uncheck",e,c)}),a.each(this.header.events,function(b,c){if(c){"string"==typeof c&&(c=d(null,c));var f=g.header.fields[b],e=a.inArray(f,g.getVisibleFields());for(var h in g.options.detailView&&!g.options.cardView&&(e+=1),c)g.$body.find("tr").each(function(){var b=a(this),d=b.find(g.options.cardView?".card-view":"td").eq(e),i=h.indexOf(" "),j=h.substring(0,i),k=h.substring(i+1),l=c[h];d.find(k).off(j).on(j,function(a){var c=b.data("index"),d=g.data[c],e=d[f];l.apply(this,[a,e,d,c])})})}}),this.updateSelected(),this.resetView(),this.trigger("post-body")},a.extend(a.fn.bootstrapTable.defaults,{treeView:!1,treeField:"name",treeId:"id",treeCollapseAll:!1,collapseIcon:"glyphicon glyphicon-chevron-right",expandIcon:"glyphicon glyphicon-chevron-down"})})(jQuery);